<script language="javascript" type="text/javascript">

function contextStart(info,tab){
    chrome.tabs.executeScript(tab.id, {"code":"(function(){a=document.createElement('p');a.innerHTML='"+info.srcUrl+"';a.id='uniqueidnoonewilleverthinktouse';document.body.appendChild(a);})()"});
    setTimeout("",500);
    chrome.tabs.executeScript(tab.id, {"file":"myscript.js"});
/*    container = document.createElement("div");
    loadinggif = document.createElement('img');
    loadinggif.src = "http://europass.cedefop.europa.eu/cvonline/images/loading.gif";
    loadinggif.setAttribute("style", "margin-left:auto;margin-right:auto;margin-top:-281px;top:50%;");
    container.setAttribute("style", "margin-left:auto;margin-right:auto;margin-top:-300px;height:600px;width=880px;top:50%;background-color:rgba(200,200,200,0.8);");
    
    console.log(info);
    console.log(tab);
    xhr = new XMLHttpRequest();
    xhr.onreadystatechange = function(){
        if (xhr.readyState==4 && (xhr.status==0 || xhr.status==200)){
            myobj = JSON.parse(xhr.responseText);
            //console.log(myobj);
            results = myobj.findItemsByKeywordsResponse[0].searchResult[0].item;
            console.log(results);
        }
    }
    xhr.open("GET", "http://127.0.0.1:8000/images?"+info.srcUrl,true);
    xhr.send();*/
}
chrome.contextMenus.create({"title":"Search eBay by image", "contexts":["image"],"onclick":contextStart},function(){console.log("success");});
</script>
